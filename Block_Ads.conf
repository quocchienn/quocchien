[General]
skip-proxy = 127.0.0.1, ::1
bypass-system = true
tun-excluded-routes = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12
private-ip-range = 127.0.0.1, 172.16.0.0/12, 192.168.0.0/16

[Rule]
# Chặn các tên miền quảng cáo của YouTube (tối thiểu để không ảnh hưởng đến phát video)
DOMAIN-SUFFIX,googleads.g.doubleclick.net,REJECT
DOMAIN-SUFFIX,adservice.google.com,REJECT
DOMAIN-SUFFIX,googlesyndication.com,REJECT
DOMAIN-SUFFIX,ads.youtube.com,REJECT
DOMAIN-SUFFIX,pagead2.googlesyndication.com,REJECT
DOMAIN-SUFFIX,ad.doubleclick.net,REJECT
DOMAIN-SUFFIX,ads.ytimg.com,REJECT
DOMAIN-SUFFIX,partner.googleadservices.com,REJECT

# Cho phép tất cả các request từ googlevideo.com để tránh lỗi phát video
DOMAIN-SUFFIX,googlevideo.com,DIRECT

[URL Rewrite]
# Chặn URL quảng cáo và theo dõi cơ bản
^https?:\/\/(.*)\.youtube\.com\/api\/stats\/ads.*$ reject
^https?:\/\/(.*)\.youtube\.com\/get_midroll_info.*$ reject
^https?:\/\/(.*)\.youtube\.com\/pagead\/.*$ reject
^https?:\/\/.*\.youtube\.com\/.*ads.*$ reject
^https?:\/\/.*\.youtube\.com\/.*pagead.*$ reject

[MITM]
# Bỏ phần hostname để tránh gây lỗi không mong muốn
# Nếu muốn thử lại MITM, có thể thêm lại sau: *.googlevideo.com, *.youtube.com
hostname = *.googlevideo.com, *.youtube.com, googleads.g.doubleclick.net, pagead2.googlesyndication.com

[Script]
# Chặn quảng cáo bằng script đơn giản, tránh chặn quá nhiều request
http-response ^https?:\/\/(.*)\.youtube\.com\/api\/stats\/ads reject-dict
http-response ^https?:\/\/(.*)\.youtube\.com\/get_midroll_info reject-dict
http-response ^https?:\/\/(.*)\.youtube\.com\/pagead\/.* reject-dict
http-response ^https?:\/\/.*\.youtube\.com\/.*ads.* reject-dict
http-response ^https?:\/\/.*\.youtube\.com\/.*pagead.* reject-dict

[Header Rewrite]
User-Agent = Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.0 Mobile/15E148 Safari/604.1